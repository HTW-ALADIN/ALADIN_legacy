(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["replay"],{"8dee":function(e,t,a){},c903:function(e,t,a){},cb8e:function(e,t,a){"use strict";a("c903")},dbf9:function(e,t,a){"use strict";a.r(t);var r=a("7a23"),n=Object(r["withScopeId"])("data-v-618b57e4");Object(r["pushScopeId"])("data-v-618b57e4");var o={class:"task"};Object(r["popScopeId"])();var c=n((function(e,t,a,c,s,i){var l=Object(r["resolveComponent"])("DecisionNode"),u=Object(r["resolveComponent"])("Canvas"),p=Object(r["resolveComponent"])("ReplayOverlay");return Object(r["openBlock"])(),Object(r["createBlock"])("div",o,[Object(r["createVNode"])(r["Transition"],{name:"slidedown"},{default:n((function(){return[c.isDecisionNode?(Object(r["openBlock"])(),Object(r["createBlock"])(l,{key:0,storeObject:c.replayStore},null,8,["storeObject"])):Object(r["createCommentVNode"])("",!0)]})),_:1}),Object(r["createVNode"])(r["Transition"],{name:"slidedown"},{default:n((function(){return[!c.isDecisionNode&&c.isLoaded?(Object(r["openBlock"])(),Object(r["createBlock"])(u,{key:c.currentNode,storeObject:c.replayStore},null,8,["storeObject"])):Object(r["createCommentVNode"])("",!0)]})),_:1}),Object(r["createVNode"])(p,{replayStore:c.replayStore,taskStore:c.taskStore},null,8,["replayStore","taskStore"])])})),s=a("6c02"),i=a("9ce3"),l=a("67b6"),u=a("0f38"),p=Object(r["withScopeId"])("data-v-49bb9895");Object(r["pushScopeId"])("data-v-49bb9895");var d={class:"replayOverlay"},f=Object(r["createVNode"])("img",{class:"fakeCursor",src:"/img/fake_cursor.png"},null,-1),v=Object(r["createVNode"])("div",{class:"progress"},null,-1),m={class:"controlElements"};Object(r["popScopeId"])();var b=p((function(e,t,a,n,o,c){var s=Object(r["resolveComponent"])("Button");return Object(r["openBlock"])(),Object(r["createBlock"])("div",d,[f,Object(r["createVNode"])("div",{class:"replay",onMouseenter:t[2]||(t[2]=function(){return n.fadeControlsIn&&n.fadeControlsIn.apply(n,arguments)}),onMouseleave:t[3]||(t[3]=function(){return n.fadeControlsOut&&n.fadeControlsOut.apply(n,arguments)})},[Object(r["createVNode"])("div",{class:"progressBar",onClick:t[1]||(t[1]=function(){return n.jumpHandler&&n.jumpHandler.apply(n,arguments)})},[v,(Object(r["openBlock"])(!0),Object(r["createBlock"])(r["Fragment"],null,Object(r["renderList"])(n.replayGraph.steps,(function(e,t){return Object(r["openBlock"])(),Object(r["createBlock"])("div",{class:"marker__".concat(t," marker"),style:n.placeMarker(t),key:e.timestamp},"|",6)})),128))]),Object(r["createVNode"])("div",m,[Object(r["createVNode"])(s,{class:"playButton",callback:n.startStopHandler,label:"â–º"},null,8,["callback"]),Object(r["createVNode"])(s,{class:"enterButton",callback:n.enterTask,label:"ðŸ—²"},null,8,["callback"])])],32)])})),y=(a("99af"),a("4de4"),a("4160"),a("d81d"),a("13d5"),a("4fad"),a("07ac"),a("159b"),a("3835")),O=a("2a7d"),j={name:"ReplayOverlay",props:{replayStore:Object,taskStore:Object},components:{Button:O["a"]},setup:function(e){var t,a,n=Object(s["d"])(),o=e.replayStore,c=o.store,i=o.getProperty,l=o.setProperty,u=Object(r["computed"])((function(){var e=i("taskReplay");return e||{}})),p=.6*window.innerWidth*.95,d=.215*window.innerWidth,f=function(e){var t={start:(new Date).getTime(),duration:0,end:0};return Object.values(e).forEach((function(e){if(e.length){var a=e[0].timestamp,r=e[e.length-1].timestamp;a<t.start&&(t.start=a),r>t.end&&(t.end=r)}})),t.duration=t.end-t.start,t},v=function(e,t){var a=e.mouse,r=t,n=[],o=a.reduce((function(e,t){var a=t.timestamp;return a-r<=50?n.push(t):(e[r]=n,n=[t]),r+=50,e}),{});return o},m=t,b={};Object(r["watch"])(u,(function(e){l({path:"currentTask",value:e.steps[0].value});var r=f(e);t=r.start,a=r.duration,r.end,b=v(e,t),m=t}));var O,j,k=function(e){var r=u.value.steps[e].timestamp,n=r-t,o=n/a,c=o*p;return{left:"".concat(c,"px")}},h=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=document.querySelector(".fakeCursor"),r=u.value.mouse;if(t){var n=r.filter((function(t){return t.timestamp<e}));if(n.length){var o=n[n.length-1],c=o.x,s=o.y;a.style.transform="translate(".concat(c,"px, ").concat(s,"px)")}}else e in b&&b[e].forEach((function(e){var t=e.x,r=e.y;a.style.transform="translate(".concat(t,"px, ").concat(r,"px)")}))},g={x:5e3,y:5e3},w=function(e){if(g){var t=g,a=t.x,r=t.y,n=u.value.panning.filter((function(t){return t.timestamp<e&&t.timestamp>m}));n.forEach((function(e){var t=Math.abs(a)-Math.abs(e.x),n=Math.abs(r)-Math.abs(e.y);window.panzoom.pan(t,n,{relative:!0,animate:!0}),g=window.panzoom.getPan()}))}},S=function(e){var t=u.value.zooming.filter((function(t){return t.timestamp<e&&t.timestamp>m}));t.forEach((function(e){var t=e.scale,a=e.x,r=e.y;window.panzoom.zoomToPoint(t,{clientX:a,clientY:r},{animate:!0})}))},N=function(e){var t=[];e<m?(c.dispatch("clearState"),t=u.value.steps.filter((function(t){return t.timestamp<e}))):t=u.value.steps.filter((function(t){return t.timestamp<e&&t.timestamp>m})),t.forEach((function(e){var t=e.path,a=e.value;l({path:t,value:a})}))},C=function(e){var r=e/p*a+t;return r},T=function(e){var t=e.currentTarget,a=t.firstChild,r=e.pageX-d;a.style.width="".concat(r,"px");var n=C(r);m=n,b=v(u.value,n),N(n),h(n,!0),w(n),S(n)},B=!1,I=function(e){var t=e.currentTarget;if(B)return clearInterval(O),B=!B,void(t.innerHTML="&#9658;");t.innerHTML="&#10074; &#10074;",B=!B;var r=50,n=m,o=r*p/a,c=document.querySelector(".progress");O=setInterval((function(){var e=c.offsetWidth,a=e+o;a>p&&(clearInterval(O),B=!B,t.innerHTML="&#9658;"),c.style.width="".concat(a,"px"),n+=r,N(n),h(n),w(n),m=n,!g&&window.panzoom&&(g=window.panzoom.getPan())}),r)},x=function(){var t=i("currentTask"),a=["currentTask","layoutSize","currentNode","previousNode","rootNode","topology","edges","nodes","taskData","taskReplay"];a.forEach((function(t){var a=i(t);if("taskReplay"===t){var r=Object.entries(a).reduce((function(e,t){var a=Object(y["a"])(t,2),r=a[0],n=a[1];if("meta"===r)return e;var o=n.map((function(e){var t=(new Date).getTime(),a=t-e.timestamp;return e.timestamp=t-a,e}));return e[r]=o,e}),{});a=r}e.taskStore.setProperty({path:t,value:a}),e.taskStore.store.dispatch("restoredFromReplay")})),n.push({name:"Task",params:{task:t}})},V=function(e){clearTimeout(j);var t=e.target;t.style.opacity="1"},M=function(e){var t=e.target;j=setTimeout((function(){t.style.opacity="0.3"}),3e3)};return{replayGraph:u,jumpHandler:T,startStopHandler:I,placeMarker:k,enterTask:x,fadeControlsIn:V,fadeControlsOut:M}}};a("eb48");j.render=b,j.__scopeId="data-v-49bb9895";var k=j,h={name:"Replay",components:{Canvas:i["a"],DecisionNode:u["a"],ReplayOverlay:k},setup:function(){var e=l["a"].taskStore,t=l["a"].replayStore,a=t.store,n=t.getProperty,o=(t.setProperty,Object(s["c"])());"string"===typeof o.params.id&&a.dispatch("fetchReplayGraph",{id:o.params.id});var c=Object(r["computed"])((function(){return n("currentNode")})),i=Object(r["computed"])((function(){var e=n("edges__".concat(c.value));return!!e&&e.length>1})),u=Object(r["computed"])((function(){return null!==n("currentNode")}));return{currentNode:c,isDecisionNode:i,isLoaded:u,replayStore:t,taskStore:e}}};a("cb8e");h.render=c,h.__scopeId="data-v-618b57e4";t["default"]=h},eb48:function(e,t,a){"use strict";a("8dee")}}]);
//# sourceMappingURL=replay.0082b0be.js.map